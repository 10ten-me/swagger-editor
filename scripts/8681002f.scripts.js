"use strict";function removeVendorExtensions(a){if(!angular.isObject(a))return a;var b={};return Object.keys(a).forEach(function(c){"x-"!==c.toLowerCase().substring(0,2)&&(b[c]=removeVendorExtensions(a[c]))}),b}function load(a){var b,c;if(!angular.isString(a))throw new Error("load function only accepts a string");try{JSON.parse(a)}catch(d){b=d}if(!b)return jsyaml.dump(JSON.parse(a));try{jsyaml.load(a)}catch(d){c=d}if(!c)return a;throw new Error("load function called with an invalid string")}window.PhonicsApp=angular.module("PhonicsApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.ace","ui.bootstrap","ngStorage","ngSanitize","jsonFormatter","hc.marked","ui.layout","mohsen1.json-schema-view","schemaForm"]),ace.define("ace/theme/atom_dark",["require","exports","module","ace/lib/dom"],function(a,b){b.isDark=!0,b.cssClass="ace-atom-dark",b.cssText=".ace-atom-dark {font-size:16px} .ace-atom-dark .ace_gutter {background: #1a1a1a;color: #868989}.ace-atom-dark .ace_print-margin {width: 1px;background: #1a1a1a}.ace-atom-dark {background-color: #1d1f21;color: #A8FF60}.ace-atom-dark .ace_cursor {color: white}.ace-atom-dark .ace_marker-layer .ace_selection {background: #444444}.ace-atom-dark.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #000000;border-radius: 2px}.ace-atom-dark .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-atom-dark .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #888888}.ace-atom-dark .ace_marker-layer .ace_highlight {border: 1px solid rgb(110, 119, 0);border-bottom: 0;box-shadow: inset 0 -1px rgb(110, 119, 0);margin: -1px 0 0 -1px;background: rgba(255, 235, 0, 0.1);}.ace-atom-dark .ace_marker-layer .ace_active-line {background: #2A2A2A}.ace-atom-dark .ace_gutter-active-line {background-color: #2A2A2A}.ace-atom-dark .ace_stack {background-color: rgb(66, 90, 44)}.ace-atom-dark .ace_marker-layer .ace_selected-word {border: 1px solid #888888}.ace-atom-dark .ace_invisible {color: #343434}.ace-atom-dark .ace_keyword,.ace-atom-dark .ace_meta,.ace-atom-dark .ace_storage,.ace-atom-dark .ace_storage.ace_type,.ace-atom-dark .ace_support.ace_type {color: #96CBFE}.ace-atom-dark .ace_keyword.ace_operator {color: #70C0B1}.ace-atom-dark .ace_constant.ace_character,.ace-atom-dark .ace_constant.ace_language,.ace-atom-dark .ace_constant.ace_numeric,.ace-atom-dark .ace_keyword.ace_other.ace_unit,.ace-atom-dark .ace_support.ace_constant,.ace-atom-dark .ace_variable.ace_parameter {color: #fe73fd}.ace-atom-dark .ace_constant.ace_other {color: #EEEEEE}.ace-atom-dark .ace_invalid {color: #CED2CF;background-color: #DF5F5F}.ace-atom-dark .ace_invalid.ace_deprecated {color: #CED2CF;background-color: #B798BF}.ace-atom-dark .ace_fold {background-color: #7AA6DA;border-color: #DEDEDE}.ace-atom-dark .ace_entity.ace_name.ace_function,.ace-atom-dark .ace_support.ace_function,.ace-atom-dark .ace_variable {color: #7AA6DA}.ace-atom-dark .ace_support.ace_class,.ace-atom-dark .ace_support.ace_type {color: #E7C547}.ace-atom-dark .ace_heading,.ace-atom-dark .ace_markup.ace_heading,.ace-atom-dark .ace_string {color: #B9CA4A}.ace-atom-dark .ace_entity.ace_name.ace_tag,.ace-atom-dark .ace_entity.ace_other.ace_attribute-name,.ace-atom-dark .ace_meta.ace_tag,.ace-atom-dark .ace_string.ace_regexp,.ace-atom-dark .ace_variable {color: #96CBFE}.ace-atom-dark .ace_comment {color: #7a7a7a}.ace-atom-dark .ace_c9searchresults.ace_keyword {color: #C2C280;}.ace-atom-dark .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYFBXV/8PAAJoAXX4kT2EAAAAAElFTkSuQmCC) right repeat-y}";var c=a("../lib/dom");c.importCssString(b.cssText,b.cssClass)}),PhonicsApp.config(["$provide",function(a){a.constant("snippets",[{name:"swagger",trigger:"sw",path:[],content:['swagger: "2.0"',"${1}"].join("\n")},{name:"info",trigger:"info",path:[],content:["info:","  version: ${1:0.0.0}","  title: ${2:title}","  description: ${3:description}","  termsOfService: ${4:terms}","  contact:","    name: ${5}","    url: ${6}","    email: ${7}","  license:","    name: ${8:MIT}","    url: ${9:http://opensource.org/licenses/MIT}","${10}"].join("\n")},{name:"paths",trigger:"pa",path:[],content:["paths:","  ${1}"].join("\n")},{name:"definitions",trigger:"def",path:[],content:["definitions:","  ${1}"].join("\n")},{name:"path",trigger:"path",path:["paths"],content:["/${1}:","  ${2}"].join("\n")},{name:"get",trigger:"get",path:["paths","*"],content:["${1:get}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"post",trigger:"post",path:["paths","."],content:["${1:post}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"put",trigger:"put",path:["paths","."],content:["${1:put}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"delete",trigger:"delete",path:["paths","."],content:["${1:delete}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"patch",trigger:"patch",path:["paths","."],content:["${1:patch}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"options",trigger:"options",path:["paths","."],content:["${1:options}:","  summary: ${2}","  description: ${2}","  responses:","    ${3:response}","  parameters:","    ${4:parameter}","  tags: ${5:[]}","${6}"].join("\n")},{name:"parameter",trigger:"param",path:["paths",".",".","parameters"],content:["- name: ${1:parameter_name}","  in: ${2:in}","  description: ${3:description}","  type: ${4:string}","${5}"].join("\n")},{name:"response",trigger:"resp",path:["paths",".",".","responses"],content:["${1:code}:","  description: ${2}","  schema: ${3}","${4}"].join("\n")},{name:"200",trigger:"200",path:["paths",".",".","responses"],content:["200:","  description: ${1}","  schema:","    type: ${2}","${4}"].join("\n")},{name:"model",trigger:"mod|def",regex:"mod|def",path:["definitions"],content:["${1:ModelName}:","  properties:","    ${2}"]}])}]),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("require","linker"),ga("linker:autoLink",["wordnik.github.io","apigee.github.io","swagger.wordnik.com","editor.swagger.wordnik.com","swagger.io"]),ga("create","UA-51231036-1","auto",{allowLinker:!0}),ga("send","pageview"),_.templateSettings={interpolate:/\{(.+?)\}/g},PhonicsApp.controller("MainCtrl",["$rootScope","$stateParams","$location","Editor","Storage","FileLoader","BackendHealthCheck","defaults",function(a,b,c,d,e,f,g,h){function i(){e.load("yaml").then(function(d){var g;b.import?(g=b.import,c.search("import",null)):d||(g=h.examplesFolder+h.exampleFiles[0]),g&&f.loadFromUrl(g).then(function(b){b&&(e.save("yaml",b),a.editorValue=b)})})}a.$on("$stateChangeStart",d.initializeEditor),g.startChecking(),a.$on("$stateChangeStart",i),a.isPreviewMode="edit"!==b.mode,$("body").addClass(h.brandingCssClass),i()}]),PhonicsApp.controller("HeaderCtrl",["$scope","$modal","$stateParams","$state","$rootScope","Storage","Builder","FileLoader","ASTManager","Editor","Codegen","defaults","strings",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){b.open({templateUrl:"templates/code-gen-error-modal.html",controller:"GeneralModal",size:"large",resolve:{data:function(){return a.data}}})}function o(){var b="text/plain";f.load("yaml").then(function(c){var d=jsyaml.load(c);d.info.version&&(d.info.version=String(d.info.version)),d.swagger&&(d.swagger=2===d.swagger?"2.0":String(d.swagger)),d=JSON.stringify(d,null,4);var e=new Blob([d],{type:b});a.jsonDownloadHref=window.URL.createObjectURL(e),a.jsonDownloadUrl=[b,"swagger.json",a.jsonDownloadHref].join(":");var f=new Blob([c],{type:b});a.yamlDownloadHref=window.URL.createObjectURL(f),a.yamlDownloadUrl=[b,"swagger.yaml",a.yamlDownloadHref].join(":")})}function p(){}a.breadcrumbs=c.path?[{active:!0,name:c.path}]:[],f.addChangeListener("progress",function(b){a.status=m.stausMessages[b],a.statusClass=null,b>0&&(a.statusClass="success"),0>b&&(a.statusClass="error")}),f.load("intro").then(function(b){b||l.disableNewUserIntro||(a.showAbout=!0,f.save("intro",!0))}),a.disableCodeGen=l.disableCodeGen,k.getServers().then(function(b){a.servers=b}),k.getClients().then(function(b){a.clients=b}),a.getServer=function(a){k.getServer(a).then(p,n)},a.getClient=function(a){k.getClient(a).then(p,n)},a.showFileMenu=function(){return!l.disableFileMenu},a.showHeaderBranding=function(){return l.headerBranding},a.newProject=function(a){h.loadFromUrl("spec-files/guide.yaml").then(function(b){b=a?"":b,f.save("yaml",b),e.editorValue=b,e.$digest(),i.refresh(),d.go("home",{mode:"edit"})})},a.assignDownloadHrefs=function(){o(a,f)},a.openImportFile=function(){b.open({templateUrl:"templates/file-import.html",controller:"FileImportCtrl",size:"large"})},a.openImportUrl=function(){b.open({templateUrl:"templates/url-import.html",controller:"UrlImportCtrl",size:"large"})},a.toggleAboutEditor=function(b){a.showAbout=b},a.openEditorPreferences=j.showSettings,a.adjustFontSize=j.adjustFontSize,a.openExamples=function(){b.open({templateUrl:"templates/open-examples.html",controller:"OpenExamplesCtrl",size:"large"})}}]),PhonicsApp.controller("FileImportCtrl",["$scope","$modalInstance","$rootScope","$localStorage","FileLoader","Storage","ASTManager",function(a,b,c,d,e,f,g){var h;a.fileChanged=function(a){h=e.load(a)},a.ok=function(){angular.isString(h)&&(c.editorValue=h,f.save("yaml",h),g.refresh()),b.close()},a.isInvalidFile=function(){return null===h},a.isFileSelected=function(){return!!h},a.cancel=b.close}]),PhonicsApp.controller("EditorCtrl",["$scope","$rootScope","Editor","Builder","Storage","ASTManager",function(a,b,c,d,e,f){function g(){var a=b.editorValue;e.save("yaml",a),f.refresh()}var h=_.debounce(g,200);a.aceLoaded=c.aceLoaded,a.aceChanged=function(){e.save("progress",0),h()},c.ready(function(){e.load("yaml").then(function(a){b.editorValue=a,g()})})}]),PhonicsApp.controller("PreviewCtrl",["Storage","Builder","ASTManager","Sorter","Editor","BackendHealthCheck","FocusedPath","TagManager","$scope","$rootScope","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){c.refresh(a),(f.isHealthy()||j.isPreviewMode)&&b.buildDocs(a).then(m,m)}function m(b){var c={};angular.isString(k.tags)&&(c.tagsToLimitTo=k.tags.split(",")),i.specs=d.sort(b.specs,c),i.error=null,h.resetTags(),angular.isObject(i.specs)&&h.registerRootTags(i.specs.tags),a.save("progress",1),j.isPreviewMode||e.clearAnnotation(),b.error&&(b.error.yamlError&&!j.isPreviewMode&&e.annotateYAMLErrors(b.error.yamlError),i.error=b.error,a.save("progress",-1))}a.addChangeListener("yaml",l),j.isPreviewMode&&a.load("yaml").then(l),c.onFoldStatusChanged(function(){_.defer(function(){i.$apply()})}),i.isCollapsed=c.isFolded,i.isAllFolded=c.isAllFolded,i.toggle=function(a){c.toggleFold(a,e)},i.toggleAll=function(a){c.setFoldAll(a,!0,e)},i.tagIndexFor=h.tagIndexFor,i.getAllTags=h.getAllTags,i.focusEdit=function(a,b,d){if(!j.isPreviewMode){var f=c.lineForPath(b);d=d||0,a.stopPropagation(),e.gotoLine(f-d)}},i.isInFocus=function(a){return!!a},i.getEditPath=function(a){return"#/paths?path="+window.encodeURIComponent(a)},i.responseCodeClassFor=function(a){var b="default";switch(Math.floor(+a/100)){case 2:b="green";break;case 5:b="red";break;case 4:b="yellow";break;case 3:b="blue"}return b},i.isVendorExtension=function(a){return"x-"===a.substring(0,2).toLowerCase()}}]),PhonicsApp.controller("GeneralModal",["$scope","$modalInstance","data",function(a,b,c){a.ok=b.close,a.cancel=b.close,a.data=c}]),PhonicsApp.controller("UrlImportCtrl",["$scope","$modalInstance","$localStorage","$rootScope","FileLoader","Storage","ASTManager",function(a,b,c,d,e,f,g){var h;a.url=null,a.fetch=function(b){angular.isString("string")&&b.indexOf("http")>-1&&e.loadFromUrl(b).then(function(b){h=b,a.canImport=!0},function(b){a.error=b,a.canImport=!1})},a.ok=function(){angular.isString(h)&&(f.save("yaml",h),d.editorValue=h,g.refresh()),b.close()},a.cancel=b.close}]),PhonicsApp.controller("ErrorPresenterCtrl",["$scope","$rootScope",function(a,b){function c(a){return a.map(function(a){return[a.message,"at "+a.path.join(" ▹ ")].join("\n")}).join("\n\n")}a.docsMode=!1,a.isCollapsed=b.isPreviewMode,a.getError=function(){var b=a.$parent.error;return b&&b.emptyDocsError&&!a.docsMode?null:b},a.getType=function(){var b=a.getError();return b.swaggerError&&b.swaggerError.errors.length?"Swagger Error":b.swaggerError&&!b.swaggerError.errors.length?"Swagger Warning":b.yamlError?"YAML Syntax Error":b.resolveError?"Resolve Error":b.emptyDocsError?"Empty Document Error":"Unknown Error"},a.getDescription=function(){var b=a.getError();if(b.emptyDocsError)return b.emptyDocsError.message;if(b.swaggerError){if(b.swaggerError.errors.length)return c(b.swaggerError.errors);if(b.swaggerError.warnings.length)return c(b.swaggerError.warnings)}return b.yamlError?b.yamlError.message.replace("JS-YAML: ","").replace(/./,function(a){return a.toUpperCase()}):b.resolveError?b.resolveError:b},a.getErrorLevel=function(){var b=a.getError();return b.swaggerError&&!b.swaggerError.errors.length?"warning":"error"},a.getLineNumber=function(){var b=a.getError();return b&&b.yamlError?b.yamlError.mark.line:-1},a.showLineJumpLink=function(){return-1!==a.getLineNumber()},a.toggleCollapse=function(){a.isCollapsed=!a.isCollapsed}}]),PhonicsApp.controller("OpenExamplesCtrl",["$scope","$modalInstance","$rootScope","FileLoader","Builder","Storage","ASTManager","defaults",function(a,b,c,d,e,f,g,h){a.files=h.exampleFiles,a.selectedFile=h.exampleFiles[0],a.open=function(a){d.loadFromUrl("spec-files/"+a).then(function(a){f.save("yaml",a),g.refresh(a),c.editorValue=a,b.close()},b.close)},a.cancel=b.close}]),PhonicsApp.directive("onReadFile",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=a(d.onReadFile);c.on("change",function(a){var c=new FileReader;c.onload=function(a){b.$apply(function(){e(b,{$fileContent:a.target.result})})},c.readAsText((a.srcElement||a.target).files[0])})}}}]),PhonicsApp.directive("path",function(){return{restrict:"E",replace:!0,templateUrl:"templates/path.html",scope:!1}}),PhonicsApp.directive("operation",["defaults",function(a){return{restrict:"E",replace:!0,templateUrl:"templates/operation.html",scope:!1,link:function(b){b.isTryOpen=!1,b.enableTryIt=a.enableTryIt,b.toggleTry=function(){b.isTryOpen=!b.isTryOpen}}}}]),PhonicsApp.directive("schemaModel",["$parse",function(a){return{templateUrl:"templates/schema-model.html",restrict:"E",replace:!0,scope:{schema:"="},link:function(b,c,d){b.mode="model",b.json=removeVendorExtensions(a(d.schema)(b.$parent))}}}]),PhonicsApp.directive("stopEvent",function(){return{restrict:"A",link:function(a,b){b.bind("click",function(a){a.stopPropagation()})}}}),PhonicsApp.directive("scrollIntoViewWhen",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.scrollIntoViewWhen,function(a){a&&b.scrollIntoView(100)})}}}),PhonicsApp.directive("collapseWhen",function(){var a=200;return{restrict:"A",link:function(b,c,d){function e(){setTimeout(function(){c.removeAttr("style")},a)}var f=null;if(d.collapseWhen){var g=c.clone();g.removeAttr("style"),g.appendTo("body"),f=g.height(),g.remove()}b.$watch(d.collapseWhen,function(a){a?(f=c.height(),c.height(f),c.height(0),c.addClass("c-w-collapsed"),e()):(c.height(f),c.removeClass("c-w-collapsed"),e())})}}}),PhonicsApp.config(["$provide",function(a){a.constant("defaults",{codegen:{servers:"http://generator.wordnik.com/online/api/gen/servers",clients:"http://generator.wordnik.com/online/api/gen/clients",server:"http://generator.wordnik.com/online/api/gen/servers/{language}",client:"http://generator.wordnik.com/online/api/gen/clients/{language}"},disableCodeGen:!0,examplesFolder:"/spec-files/",exampleFiles:["default.yaml","heroku-pets.yaml","minimal.yaml","petstore_simple.yaml","petstore_full.yaml","security.yaml"],autocompleteExtension:{},backendEndpoint:"/editor/spec",useBackendForStorage:!1,backendHelathCheckTimeout:5e3,useYamlBackend:!1,disableFileMenu:!1,headerBranding:!1,enableTryIt:!0,brandingCssClass:"",schemaUrl:"/schema/swagger.json"})}]),PhonicsApp.config(["$provide",function(a){a.constant("strings",{stausMessages:{"-2":"Unsaved Changes. Check your server connection","-1":"Error!",0:"Working...",1:"All changes saved."}})}]),PhonicsApp.filter("formdata",function(){return function(a){var b=[];return angular.isObject(a)&&Object.keys(a).forEach(function(c){angular.isDefined(a[c])&&b.push(c+": "+a[c])}),b.join("\n")}}),PhonicsApp.controller("TryOperation",["$scope","formdataFilter",function(a,b){function c(a){var b=_.extend(a,{schema:d(a),form:e(a),model:{}});return a.schema&&"array"===a.schema.type&&(b.model[a.name]=[]),b}function d(a){var b;return a&&a.schema?(a.schema.type||(a.schema.type="object"),"array"===a.schema.type?(b={type:"object",properties:{}},b.properties[a.name]=a.schema,b.properties[a.name].type="array",b.properties[a.name].items.type="object",b):a.schema):(b={type:"object",properties:{}},b.properties[a.name]=_.pick(a,"type","description","required","format"),b)}function e(a){if(a.schema&&"array"===a.schema.type){var b=[{key:a.name}];return b[0].items=[a.name+"[]"],b}return["*"]}function f(a){return function(b,c){return c.in===a&&c.model[c.name]&&c["default"]!==c.model[c.name]&&(b[c.name]=c.model[c.name]),b}}function g(){return a.scheme?a.scheme:a.walkToProperty("schemes")[0]}function h(){var b=g(),c=o.host||window.location.host,d=o.basePath||"",e=_.template(a.path.pathName),h=a.parameters.reduce(f("path"),{}),i=a.parameters.reduce(f("query"),{}),j=$.param(i),k="";try{k=e(h)}catch(l){}return b+"://"+c+d+k+(j?"?"+j:"")}function i(){return a.parameters.map(function(a){return"body"===a.in?k(a):void 0})[0]}function j(){return a.parameters.filter(function(a){return"header"===a.in}).reduce(function(a,b){var c=k(b)[b.name];return c&&(a[b.name]=c),a},{})}function k(a){return Array.isArray(a.model[a.name])?a.model[a.name]:a.model}function l(){a.xhrInProgress=!0,a.error=null,$.ajax({url:a.generateUrl(),type:a.operation.operationName,headers:j(),data:i(),accepts:a.accepts}).fail(function(b,c,d){a.xhrInProgress=!1,a.textStatus=c,a.error=d,a.xhr=b,a.$digest()}).done(function(b,c,d){a.textStatus=c,a.xhrInProgress=!1,a.responseData=b,a.xhr=d,a.responseHeaders=n(d),a.$digest()})}function m(a){var b={};return a.split("\n").forEach(function(a){var c=a.split(":")[0],d=a.split(":")[1];c&&angular.isString(c)&&angular.isString(d)&&(b[c.trim()]=d.trim())}),b}function n(a){return m(a.getAllResponseHeaders())}var o=a.$parent.specs,p="";a.httpProtorcol="HTTP/1.1",a.generateUrl=h,a.makeCall=l,a.xhrInProgress=!1,a.parameters=Array.isArray(a.operation.parameters)?a.operation.parameters.map(c):[],a.hasBodyParam=function(){return a.parameters.some(function(a){return"body"===a.in})},a.rawChanged=function(a){var b=a[1];p=b.getValue()},a.getRequestBody=function(){if("raw"===a.inputMode)return p;var c=i();return"form-data"===a.bodyFormat?b(c):"json"===a.bodyFormat?JSON.stringify(c,null,2):"x-www-form-urlencoded"===a.bodyFormat?$.param(c):""},a.getHeaders=function(){var b=j();return _.extend(b,{Host:a.specs.host||window.location.host,Accept:a.accepts,"Accept-Encoding":"gzip,deflate,sdch","Accept-Language":"en-US,en;q=0.8,fa;q=0.6,sv;q=0.4","Cache-Control":"no-cache",Connection:"keep-alive",Origin:window.location.origin,Referer:window.location.origin+window.location.pathname,"User-Agent":window.navigator.userAgent})},a.walkToProperty=function(b){var c={consumes:["*/*"],schemes:["http"]};return Array.isArray(a.operation[b])?a.operation[b]:Array.isArray(a.specs[b])?a.specs[b]:c[b]?c[b]:void 0},a.setInputMode=function(b){a.inputMode=b},a.prettyPrint=function(a){try{return JSON.stringify(JSON.parse(a),null,2)}catch(b){}return a},a.isJson=function(a){var b;try{JSON.parse(a)}catch(c){b=c}return!b},a.isHTML=function(a){var b=window.document.createElement("div");b.innerHTML=a;for(var c=b.childNodes,d=c.length;d--;)if(1===c[d].nodeType)return!0;return!1},a.isPlain=function(b){return!a.isHTML(b)&&!a.isJson(b)}}]),PhonicsApp.service("Sorter",function(){function a(a){var c=[];return angular.isObject(a)?(c=Object.keys(a).map(function(c){if(c.toLowerCase().substring(0,2)!==d){var e={operationName:c,responses:b(a[c].responses)};return a[c]=_.omit(a[c],"responses"),_.extend(e,a[c]),e}}),_.compact(c)):c}function b(a){var b=[];return angular.isObject(a)?(b=Object.keys(a).map(function(b){if(b.toLowerCase().substring(0,2)!==d){var c=_.extend({responseCode:b},a[b]);return c}}),_.compact(b)):b}function c(a){return function(b){if(!a)return!0;if(Array.isArray(a)&&Array.isArray(b.tags))for(var c=0;c<a.length;c++)for(var d=0;d<b.tags.length;d++)if(a[c]===b.tags[d])return!0;return!1}}var d="x-";this.sort=function(b,e){if(b&&b.paths){var f=Object.keys(b.paths).map(function(f){return f.toLowerCase().substring(0,2)!==d?{pathName:f,operations:a(b.paths[f]).filter(c(e.limitToTags))}:void 0});b.paths=_.compact(f)}return b}}),PhonicsApp.service("TagManager",function(){function a(a,b){this.name=a,this.description=b}function b(b,d){var e=c.map(function(a){return a.name});_.include(e,b)||c.push(new a(b,d))}var c=[];this.resetTags=function(){c=[]},this.tagIndexFor=function(a){for(var d=0;d<c.length;d++)if(c[d].name===a)return d;return b(a),c.length-1},this.getAllTags=function(){return c},this.registerRootTags=function(a){Array.isArray(a)&&a.forEach(function(a){angular.isString(a.name)&&b(a.name,a.description)})},this.registerTag=b}),PhonicsApp.service("Autocomplete",["$rootScope","snippets","ASTManager","KeywordMap",function(a,b,c,d){function e(a){var b=c.pathForPosition(a.row,a.column-1);return b}function f(a,b){if(!Array.isArray(a)||!Array.isArray(b))return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)return new RegExp(b[c]).test(a[c]);return!0}function g(b){c.refresh(a.editorValue);var d=e(b);return d||1!==b.column||(d=[]),function(a){return f(d,a.path)}}function h(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;e++)if(c=new RegExp(d[e]),c.test(b)&&a[d[e]])return a[d[e]]}function i(a){var b=e(a),c=d.get(),f=b.shift();if(!Array.isArray(b))return[];for(;f&&angular.isObject(c);)c=h(c,f),f=b.shift();if(!angular.isObject(c))return[];var g=Object.keys(c).map(function(a){return{name:a,value:a,score:300,meta:"swagger"}});return g}function j(a){return a.score=1e3,a}var k=null,l={getCompletions:function(a,c,d,e,f){a.completer.autoSelect=!0;var h=b.filter(g(d)).map(function(a){return{caption:a.name,snippet:a.content,meta:"snippet"}}).map(j),k=i(d);f(null,k.concat(h))}};this.init=function(a){k=a,k.completers=[l]}}]),PhonicsApp.service("FileLoader",["$http",function(a){this.loadFromUrl=function(b){return angular.isString(b)&&b.indexOf("http")>-1&&(b="https://cors-it.herokuapp.com/?url="+b),a({method:"GET",url:b,headers:{accept:"application/x-yaml,text/yaml,application/json,*/*"}}).then(function(a){return angular.isObject(a.data)?jsyaml.dump(a.data):load(a.data)})},this.load=load}]),PhonicsApp.service("Editor",["Autocomplete","ASTManager","LocalStorage","$interval",function(a,b,c,d){function e(a){a&&a.mark&&a.reason&&w.getSession().setAnnotations([{row:a.mark.line,column:a.mark.column,text:a.reason,type:"error"}])}function f(){w.getSession().clearAnnotations()}function g(c){window.e=w=c,ace.config.set("basePath","bower_components/ace-builds/src-noconflict"),a.init(c),w.setOptions({fontFamily:"Source Code Pro",enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0}),i(),b.refresh(w.getValue()),p(b.onFoldChanged),x.forEach(function(a){a(z)}),x=[];var d=w.getSession();d.on("changeFold",j),k(d)}function h(){w&&c.save("editor-settings",w.getOptions())}function i(){w&&c.load("editor-settings").then(function(a){a?w.setOptions(a):w.setOption("theme","ace/theme/atom_dark")})}function j(){var a=arguments;y.forEach(function(b){b.apply(w,a)})}function k(a){a.setTabSize(2)}function l(){w.resize()}function m(a){angular.isFunction(a)&&x.push(a)}function n(){var a=w.getSession(),b=null;return a.foldAll(),b=a.unfold(),Array.isArray(b)?b:[]}function o(a){return w.session.getLine(a)}function p(a){y.push(a)}function q(a,b){w&&w.getSession().foldAll(a,b)}function r(a){w&&w.getSession().unfold(a,100)}function s(a){w.gotoLine(a)}function t(){return w?w.getCursorPosition().row:null}function u(){ace.config.loadModule("ace/ext/settings_menu",function(a){a.init(w),w.showSettingsMenu();var b=d(function(){0===$("#ace_settingsmenu").length&&(h(),d.cancel(b),b=void 0)},300)})}function v(a){if(w){var b=parseInt(w.getOption("fontSize"),10);w.setOption("fontSize",b+a),h()}}var w=null,x=[],y=[],z=this;this.aceLoaded=g,this.resize=l,this.ready=m,this.annotateYAMLErrors=e,this.clearAnnotation=f,this.getAllFolds=n,this.getLine=o,this.onFoldChanged=p,this.addFold=q,this.removeFold=r,this.gotoLine=s,this.lineInFocus=t,this.showSettings=u,this.saveEditorSettings=h,this.adjustFontSize=v}]),PhonicsApp.service("Builder",["Resolver","$q",function(a,b){function c(c){var d,e=b.defer();if(!c)return e.reject({specs:null,error:{emptyDocsError:{message:"Empty Document"}}}),e.promise;try{d=f(c)}catch(g){return e.reject({error:{yamlError:g},specs:null}),e.promise}if(d&&d.definitions)for(var h in d.definitions)_.isEmpty(d.definitions[h].title)&&(d.definitions[h].title=h);return a.resolve(d).then(function(a){var c={specs:a},e=b.defer(),f=SwaggerTools.specs.v2.validate(d);return f?(c.error={swaggerError:f},e.reject(c)):e.resolve(c),e.promise},function(a){return{error:{resolveError:a.data,raw:a},specs:d}})}function d(a,b,c){var d,e=null;try{d=f(a)}catch(g){e={yamlError:g}}return e||(c.paths[b]=d[b]),{specs:c,error:e}}function e(a,b){return _.pick(a.paths,b)}var f=_.memoize(jsyaml.load);this.buildDocs=c,this.updatePath=d,this.getPath=e}]),PhonicsApp.service("ASTManager",function(){function a(a){var c=null;try{m=a||"",k=yaml.compose(a)}catch(d){c=d}c||b()}function b(){l.forEach(function(a){a()})}function c(a,b){var d;if(b=b||k,!b)return b;if(!Array.isArray(a))throw new Error("Need path to find the node in the AST");if(!a.length)return b;if(d=a.shift(),b.tag===h)for(var e=0;e<b.value.length;e++){var f=b.value[e];if(f[0].value===d)return c(a,f[1])}else if(b.tag===i)return d=parseInt(d,10),b=b.value[d],c(a,b);return b}function d(a,b){var c;if(a=a||k,!angular.isObject(a)||!a.value)return a;if(a.start_mark.line===b)return a;for(var e=0;e<a.value.length;e++)if(a.tag===h?c=d(a.value[e][1],b):a.tag===i&&(c=d(a.value[e],b)),c)return c;return null}function e(a){var b=c(a);return b?b.start_mark.line:null}function f(b,c){function d(a,j){j&&(e=j.start_mark,f=j.end_mark,e.line===b&&f.line===b&&e.column<=c&&f.column>=c?g=a:j.tag===h?j.value.forEach(function(b){d(a,b[0]),d(a.concat(b[0].value),b[1])}):j.tag===i&&j.value.forEach(function(b,c){d(a.concat(c),b)}))}var e,f,g=[],l=m.split("\n"),n=null;if(b!==l.length-1&&0!==c&&!/.\: ./.test(l[b])){n=_.clone(m);for(var o=l.slice(0,b).join("\n")+"\n",p=l[b],q=p.split("");q.length&&" "!==q.pop();)o+=" ";a(o)}if(void 0===b)return g;if(d([],k),k&&k.end_mark.line===b&&0===g.length)for(var r=k;c>0;)r.tag===h&&(g.push(r.value[r.value.length-1][0].value),r=r.value[r.value.length-1][1]),c-=j;return n&&a(n),g}function g(a,b,c){c="undefined"==typeof c?b.folded:!c,c?(a.removeFold(b.start_mark.line),b.folded=!1):(a.addFold(b.start_mark.line-1,b.end_mark.line-1),b.folded=!0)}var h="tag:yaml.org,2002:map",i="tag:yaml.org,2002:seq",j=2,k={},l=[],m="";this.onFoldChanged=function(a){var c=a.data.start.row+1,e="remove"!==a.action,f=d(k,c);f&&(f.folded=e),b()},this.toggleFold=function(a,d){var e=c(a,k);e&&e.start_mark&&(g(d,e),b())},this.setFoldAll=function(a,d,e){for(var f,j=c(a,k),l=0;l<j.value.length;l++)j.tag===h?f=j.value[l][1]:j.tag===i&&(f=j.value[l]),g(e,f,d);b()},this.isFolded=function(a){var b=c(a,k);return angular.isObject(b)&&!!b.folded},this.isAllFolded=function(a){var b,d=c(a);if(!d||!Array.isArray(d.value))return!1;for(var e=0;e<d.value.length;e++)if(d.tag===h?b=d.value[e][1]:d.tag===i&&(b=d.value[e]),!b.folded)return!1;return!0},this.onFoldStatusChanged=function(a){l.push(a)},this.refresh=a,this.lineForPath=e,this.pathForPosition=f}),PhonicsApp.service("Resolver",["$q","$http",function(a,b){function c(b,f){var g=a.defer();if(f||(f=b),Array.isArray(b))return a.all(b.map(function(a){return c(a,f)}));if(!angular.isObject(b))return g.resolve(b),g.promise;if(angular.isString(b.$ref)){if(e[b.$ref]){var h=e[b.$ref];return g.resolve(h),g.promises}return d(b.$ref,f).then(function(a){return e[b.$ref]=a,c(a,f)})}var i=[];return Object.keys(b).forEach(function(a){i.push(c(b[a],f))}),a.all(i).then(function(a){var c={};return Object.keys(b).forEach(function(b,d){c[b]=a[d]}),c})}function d(c,d){var e=a.defer();if(f[c])return e.resolve(f[c]),e.promise;if(/^http(s?):\/\//.test(c))return b.get(c).then(function(a){f[c]=a.data,e.resolve(a.data)}),e.promise;0!==c.indexOf("#/")&&(c="#/definitions/"+c);for(var g,h=c.substring(2).split("/"),i=d;h.length;)g=h.shift(),i[g]||e.reject({data:"Can not lookup "+g+" in "+angular.toJson(i)}),i=i[g];return f[c]=i,e.resolve(i),e.promise}var e={},f={};this.resolve=c}]),PhonicsApp.service("BackendHealthCheck",["$http","$interval","defaults","Storage",function(a,b,c,d){var e=!0;this.startChecking=function(){c.useBackendForStorage&&b(function(){a.get(window.location.href).then(function(){e=!0},function(){e=!1,d.save("progress",-2)})},c.backendHelathCheckTimeout)},this.isHealthy=function(){return e}}]),PhonicsApp.service("Codegen",["$http","defaults","Storage",function(a,b,c){function d(a){angular.isObject(a)&&a.code&&(window.location=a.data.code)}this.getServers=function(){return a.get(b.codegen.servers).then(function(a){return a.data})},this.getClients=function(){return a.get(b.codegen.clients).then(function(a){return a.data})},this.getServer=function(e){var f=_.template(b.codegen.server)({language:e});return c.load("yaml").then(function(b){var c=jsyaml.load(b);return a.post(f,{swagger:c}).then(d)})},this.getClient=function(e){var f=_.template(b.codegen.client)({language:e});return c.load("yaml").then(function(b){var c=jsyaml.load(b);return a.post(f,{swagger:c}).then(d)})}}]),PhonicsApp.service("FocusedPath",["ASTManager","Editor",function(a,b){this.isInFocus=function(c){var d=b.lineInFocus(),e=a.pathForPosition(d);return Array.isArray(e)&&_.isEqual(c,e.slice(0,c.length))}}]),PhonicsApp.service("Storage",["LocalStorage","Backend","defaults",function(a,b,c){return c.useBackendForStorage?b:a}]),PhonicsApp.service("LocalStorage",["$localStorage","$q",function(a,b){var c="SwaggerEditorCache",d={},e=this;a[c]=a[c]||{},this.save=function(b,e){null!==e&&(Array.isArray(d[b])&&d[b].forEach(function(a){a(e)}),_.debounce(function(){window.requestAnimationFrame(function(){a[c][b]=e})},100)())},this.reset=function(){Object.keys(a[c]).forEach(function(a){e.save(a,"")})},this.load=function(d){var e=b.defer();return e.resolve(d?a[c][d]:a[c]),e.promise},this.addChangeListener=function(a,b){angular.isFunction(b)&&(d[a]||(d[a]=[]),d[a].push(b))}}]),PhonicsApp.service("Backend",["$http","$q","defaults","Builder",function(a,b,c,d){function e(b){var e=d.buildDocs(b,{resolve:!0});e.error||a.put(c.backendEndpoint,b)}function f(){}var g={},h={},i=_.throttle(e,200,{leading:!1,trailing:!0});this.save=function(a,b){h[a]=b,Array.isArray(g[a])&&g[a].forEach(function(a){a(b)}),c.useYamlBackend&&"yaml"===a&&b?i(b):"specs"===a&&b&&i(h[a])},this.reset=f,this.load=function(d){if("yaml"!==d){var e=b.defer();return d?e.resolve(h[d]):e.reject(),e.promise
}return a.get(c.backendEndpoint).then(function(a){return c.useYamlBackend?(h.yaml=a.data,h.yaml):a.data})},this.addChangeListener=function(a,b){angular.isFunction(b)&&(g[a]||(g[a]=[]),g[a].push(b))}}]),PhonicsApp.service("KeywordMap",["defaults",function(a){var b={name:String,"in":String,description:String,required:String,type:String,format:String},c={".":String},d={description:String,schema:{type:String}},e={summary:String,description:String,schemas:{".":String},externalDocs:{".":String},operationId:String,produces:{".":String},consumes:{".":String},deprecated:Boolean,security:c,parameters:{".":b},responses:{".":d},tags:{".":String}},f={swagger:String,info:{version:String,title:String,description:String,termsOfService:String,contact:{name:String,url:String,email:String},license:{name:String,url:String}},host:String,schemas:{".":String},basePath:String,produces:{".":String},consumes:{".":String},paths:{".":{".":e}},definitions:{".":{properties:{".":String}}},parameters:{".":b},responses:{".":d},security:{".":{".":String}},securityDefinitions:{".":{".":String}},tags:{".":String},externalDocs:{".":String}};this.get=function(){var b=angular.isObject(a.autocompleteExtension)?a.autocompleteExtension:{};return _.extend(f,b)}}]),PhonicsApp.config(["$compileProvider","$stateProvider","$urlRouterProvider",function(a,b,c){c.otherwise("/"),b.state("home",{url:"/{mode}?import&tags",views:{"":{templateUrl:function(a){return"edit"===a.mode?"views/main.html":"views/main-preview.html"},controller:"MainCtrl"},"header@home":{templateUrl:"views/header/header.html",controller:"HeaderCtrl"},"editor@home":{templateUrl:"views/editor/editor.html",controller:"EditorCtrl"},"preview@home":{templateUrl:"views/preview/preview.html",controller:"PreviewCtrl"}}}),a.aHrefSanitizationWhitelist(".")}]),function(a){a.fn.scrollIntoView=function(b,c,d){function e(b,c){void 0===c?a.isFunction(f.complete)&&f.complete.call(b):f.smooth?a(b).stop().animate({scrollTop:c},f):(b.scrollTop=c,a.isFunction(f.complete)&&f.complete.call(b))}var f=a.extend({},a.fn.scrollIntoView.defaults);"object"==a.type(b)?a.extend(f,b):"number"==a.type(b)?a.extend(f,{duration:b,easing:c,complete:d}):0==b&&(f.smooth=!1);var g=1/0,h=0;1==this.size()?null==(g=this.get(0).offsetTop)||(h=g+this.get(0).offsetHeight):this.each(function(a,b){b.offsetTop<g?g=b.offsetTop:b.offsetTop+b.offsetHeight>h?h=b.offsetTop+b.offsetHeight:null}),h-=g;for(var i=this.commonAncestor().get(0),j=a(window).height();i;){var k=i.scrollTop,l=i.clientHeight;if(l>j&&(l=j),0==l&&"BODY"==i.tagName&&(l=j),i.scrollTop!=(null==(i.scrollTop+=1)||i.scrollTop)&&null!=(i.scrollTop-=1)||i.scrollTop!=(null==(i.scrollTop-=1)||i.scrollTop)&&null!=(i.scrollTop+=1))return void(k>=g?e(i,g):g+h>k+l?e(i,g+h-l):e(i,void 0));i=i.parentNode}return this},a.fn.scrollIntoView.defaults={smooth:!0,duration:null,easing:a.easing&&a.easing.easeOutExpo?"easeOutExpo":null,complete:a.noop(),step:null,specialEasing:{}},a.fn.isOutOfView=function(a){var b=!0;return this.each(function(){var c=this.parentNode,d=c.scrollTop,e=c.clientHeight,f=this.offsetTop,g=this.offsetHeight;(a?f>d+e:f+g>d+e)||(a?d>f+g:d>f)||(b=!1)}),b},a.fn.commonAncestor=function(){var b=[],c=1/0;a(this).each(function(){var d=a(this).parents();b.push(d),c=Math.min(c,d.length)});for(var d=0;d<b.length;d++)b[d]=b[d].slice(b[d].length-c);for(var d=0;d<b[0].length;d++){var e=!0;for(var f in b)if(b[f][d]!=b[0][d]){e=!1;break}if(e)return a(b[0][d])}return a([])}}(jQuery);