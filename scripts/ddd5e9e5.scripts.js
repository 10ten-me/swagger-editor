"use strict";function annotateYAMLErrors(a){var b=null,c=a.getSession().getValue();try{jsyaml.load(c)}catch(d){return b=d.message.replace("JS-YAML: ",""),a.getSession().setAnnotations([{row:d.mark.line,column:d.mark.column,text:b,type:"error"}]),b}return a.getSession().clearAnnotations(),b}function getJsonString(a){var b=jsyaml.load(a.getSession().getValue());return JSON.stringify(b,null,4)}function buildapiDeclarationDocs(a){var b=new SwaggerUi({dom_id:"swagger-ui-container-"+Math.floor(100*Math.random()),supportedSubmitMethods:["get","post","put","delete"]});return b.load(JSON.stringify(a)),b}function buildDocs(a){var b;a.invalidDocs=!1;try{b=jsyaml.load(a.editor.getSession().getValue())}catch(c){return void(a.invalidDocs=!0)}b&&Array.isArray(b.apiDeclarations)&&(a.apiDeclarations=b.apiDeclarations.map(buildapiDeclarationDocs)),a.jsonPreview&&a.jsonPreview.getSession().setValue(getJsonString(a.editor))}function getDefaultSpecs(){return $.get("spec-files/consolidated-from-json.yaml")}function setOperationsCollapsed(a,b){a.resource.operationsArray.forEach(function(a){a.collapsed=b})}window.PhonicsApp=angular.module("PhonicsApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.ace","ngStorage"]),PhonicsApp.config(["$routeProvider","$compileProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/:resource/:id",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.aHrefSanitizationWhitelist("blob:http")}]),_.templateSettings={interpolate:/\{(.+?)\}/g},PhonicsApp.controller("MainCtrl",["$scope","$localStorage",function(a,b){a.editor=null,a.jsonPreview=null,a.previewMode="html",a.editorErrorMessage="",a.invalidDocs=!1,a.aceLoaded=function(c){return a.editor=c,c.setOptions({basicAutocompletion:!0}),$(document).on("pane-resize",c.resize.bind(c)),b.cache?(c.getSession().setValue(b.cache),void buildDocs(a)):a.resetSpec()},a.jsonPreviewLoaded=function(b){a.jsonPreview=b},a.aceChanged=function(){var c=null;return b.cache=a.editor.getSession().getValue(),(c=annotateYAMLErrors(a.editor))?void(a.invalidDocs=!0):(a.editorErrorMessage="",void buildDocs(a))},a.switchPreviewMode=function(b){a.previewMode=b,"json"===b&&a.jsonPreview.getSession().setValue(getJsonString(a.editor))},a.jsonLoaded=function(){},a.newProject=function(){a.editor.getSession().setValue(""),buildDocs(a)},a.resetSpec=function(){getDefaultSpecs().then(function(c){b.cache=c,a.editor.getSession().setValue(c),buildDocs(a)})},a.assignDownloadHrefs=function(){var b="text/plain",c=new Blob([a.jsonPreview.getSession().getValue()],{type:b});a.jsonDownloadHref=window.URL.createObjectURL(c),a.jsonDownloadUrl=[b,"spec.json",a.jsonDownloadHref].join(":");var d=new Blob([a.editor.getSession().getValue()],{type:b});a.yamlDownloadHref=window.URL.createObjectURL(d),a.yamlDownloadUrl=[b,"spec.yaml",a.yamlDownloadHref].join(":")}}]),PhonicsApp.directive("splitterBar",function(){return{template:"",replace:!1,restrict:"E",link:function(a,b,c){function d(a){var d=a.pageX-f.offset().left,g=a.pageY-f.offset().top,h=100;if("horizontal"in c){if(h>g||g>f.height()-h)return;e.trigger("pane-resize"),b.css("top",g),$("#"+c.topPane).css("height",g+b.height()),$("#"+c.bottomPane).css("height",f.height()-g)}else{if(h>d||d>f.width()-h)return;e.trigger("pane-resize"),b.css("left",d),$("#"+c.leftPane).css("width",d),$("#"+c.rightPane).css("width",f.width()-d-b.width())}}var e=$(document),f=b.parent();b.on("mousedown",function(a){a.preventDefault(),e.on("mousemove",d),e.on("mouseup",function(){e.off("mousemove",d)})})}}}),PhonicsApp.directive("resource",function(){return{restrict:"E",replace:!0,templateUrl:"templates/resource.html",scope:{resource:"="},link:function(a){a.collapsed=!1,a.collapseAll=function(){a.collapsed=!1,setOperationsCollapsed(a,!0)},a.expandAll=function(){a.collapsed=!1,setOperationsCollapsed(a,!1)}}}}),PhonicsApp.directive("operation",["$timeout",function(a){function b(b){var c=!0;return b.parameters.forEach(function(b){b.required&&!b.inputValue&&(c=!1,b.shake=!0,a(function(){b.shake=!1},900))}),c}function c(a,b,c){var d=a,e={},f={};return c.forEach(function(a){"path"===a.paramType&&(e[a.name]=a.inputValue),"query"===a.paramType&&(f[a.name]=a.inputValue)}),d+=_.template(b)(e),d+="?"+$.param(f)}function d(a,d){if(b(a)){var e=a.parameters.map(function(a){var b=Object.create(null);return b[a.name]=a.inputValue,b});$.ajax({url:c(d,a.path,a.parameters),method:a.method,data:e}).then(function(a){console.log(a)})}}return{restrict:"E",replace:!0,templateUrl:"templates/operation.html",link:function(a){a.tryIt=d}}}]),PhonicsApp.directive("signature",function(){function a(a,b){return SwaggerOperation.prototype.getSampleJSON(a,b)}function b(a){return a&&a.indexOf("[")>=0?a.substring(a.indexOf("[")+1,a.indexOf("]")):void 0}function c(a,c){var d=b(a);return d&&(a=d),"object"!=typeof c[a]}function d(b){b.getSampleJSON=a,b.visibilePane=0,b.sampleJSON=a(b.type,b.models),b.isPrimitive=c(b.type,b.models)}return{scope:{models:"=",type:"="},link:d,restrict:"E",replace:!0,templateUrl:"templates/signature.html"}}),PhonicsApp.directive("dropdownMenu",function(){return{templateUrl:"templates/dropdown-menu.html",restrict:"E",transclude:!0,scope:{label:"@",onOpen:"="},link:function(a){a.open=!1,a.toggle=function(){a.open=!a.open,a.open&&"function"==typeof a.onOpen&&a.onOpen()}}}});